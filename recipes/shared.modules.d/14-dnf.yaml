modules:
    - type: script
      snippets:
        # optimise dnf config
        - "dnf config-manager --help"
        - "dnf config-manager --setopt=install_weak_deps=false --save"
        - "dnf config-manager --setopt=clean_requirements_on_remove=True --save"
        - "dnf config-manager --setopt=timeout=10 --save"
        - "dnf config-manager --setopt=minrate=50000 --save"
        - "dnf config-manager --setopt=fastestmirror=true --save"
        - "dnf config-manager --setopt=installonly_limit=10 --save"
        - "dnf config-manager --setopt=deltarpm=true -save"
        - "dnf repolist"
        - "dnf update --refresh -y"
        - "dnf install --refresh -y https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm"
        - "dnf install --refresh -y https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm"
        - "dnf config-manager setopt fedora-cisco-openh264.enabled=1"
        - "dnf install --refresh -y rpmfusion-free-release-tainted"
        - "dnf install --refresh -y rpmfusion-nonfree-release-tainted"
        # add terra repos
        - "curl -fsSL 'https://github.com/terrapkg/subatomic-repos/raw/main/terra.repo' | tee /etc/yum.repos.d/terra.repo"
        - "dnf install --refresh -y terra-release"
        - "dnf install --refresh -y terra-release-extras"
        - "dnf install --refresh -y terra-release-mesa"
        - "dnf install --refresh -y terra-release-multimedia"
        - "dnf config-manager setopt terra.enabled=1"
        - "dnf config-manager setopt terra-extras.enabled=1"
        - "dnf config-manager setopt terra-mesa.enabled=1"
        - "dnf config-manager setopt terra-multimedia.enabled=0"
        #  add tailscale repos
        - "curl -fsSL https://pkgs.tailscale.com/stable/fedora/tailscale.repo | tee /etc/yum.repos.d/tailscale.repo"
        - "dnf config-manager setopt tailscale-stable.enabled=1"
        # add copr repos
        - "dnf copr enable ublue-os/packages"
        - "dnf copr enable ublue-os/akmods"
        - "dnf copr enable che/nerd-fonts"
        - "dnf copr enable varlad/zellij"
        - "dnf copr enable bieszczaders/kernel-cachyos-addons"
        - "dnf copr enable renner/staging"
        # optimise dnf priority list
        - "dnf repolist"
        - "dnf config-manager setopt fedora.priority=59"
        - "dnf config-manager setopt updates.priority=55"
        - "dnf config-manager setopt updates-archive.priority=58"
        - "dnf config-manager setopt fedora-cisco-openh264.priority=57"
        - "dnf config-manager setopt rpmfusion-free.priority=39"
        - "dnf config-manager setopt rpmfusion-free-tainted.priority=37"
        - "dnf config-manager setopt rpmfusion-free-updates.priority=35"
        - "dnf config-manager setopt rpmfusion-nonfree.priority=38"
        - "dnf config-manager setopt rpmfusion-nonfree-updates.priority=36"
        - "dnf config-manager setopt rpmfusion-nonfree-tainted.priority=34"
        - "dnf config-manager setopt fedora-multimedia.priority=30"
        - "dnf config-manager setopt tailscale-stable.priority=45"
        - "dnf config-manager setopt terra.priority=19"
        - "dnf config-manager setopt terra-mesa.priority=18"
        - "dnf config-manager setopt terra-extras.priority=17"
        - "dnf config-manager setopt terra-multimedia.priority=40"
        - "dnf update --refresh -y"
    - type: dnf
      repos:
        cleanup: true
        files:
          remove:
            - "updates-archive"
      remove:
        auto-remove: true
        packages:
          - "fuse"
          - "gnome-shell-extension-hotedge"
          - "gnome-shell-extension-logo-menu"
          - "gnome-shell-extension-just-perfection"
          - "gnome-shell-extension-compiz-alike-magic-lamp-effect"
          - "gnome-shell-extension-compiz-windows-effect"
          - "gnome-shell-extension-desktop-cube"
          - "gnome-shell-extension-window-list"
          - "gnome-shell-extension-restart-to"
          - "gnome-shell-extension-burn-my-windows"
          - "gnome-shell-extension-places-menu"
          - "gnome-shell-extension-launch-new-instance"
          - "gnome-shell-extension-coverflow-alt-tab"
          - "gnome-shell-extension-apps-menu"
          - "gnome-shell-extension-user-theme"
          - "gnome-shell-extension-tailscale-gnome-qs"
          - "gnome-shell-extension-search-light"
          - "gnome-shell-extension-gsconnect"
          - "gnome-shell-extension-dash-to-dock"
          - "gnome-shell-extension-blur-my-shell"
          - "gnome-shell-extension-appindicator"
          - "cmake"
          #- "gcc-c++"
          - "libglvnd-devel"
          - "cmake-data"
          - "spice-protocol"
          - "nettle-devel"
          - "binutils-devel"
          - "libXi-devel"
          - "libXinerama-devel"
          - "libXcursor-devel"
          - "libXpresent-devel"
          - "libxkbcommon-x11-devel"
          - "wayland-devel"
          - "wayland-protocols-devel"
          - "libXScrnSaver-devel"
          - "libXrandr-devel"
          - "libdecor-devel"
          - "pipewire-devel"
          - "pulseaudio-libs-devel"
          - "libsamplerate-devel"
          - "winetricks"
          - "rom-properties"
          - "rom-properties-utils"
          - "rom-properties-gtk3"
          - "rom-properties-common"
          - "rom-properties-thumbnailer-dbus"
          - "discover-overlay"
          - "gnome-tweaks"
          - "firefox"
          - "firefox-langpacks"
          - "steamdeck-backgrounds"
          - "mediawriter"
          - "webapp-manager"
          - "virt-manager"
          #- "virt-viewer"
          - "vim-enhanced"
          - "vim-minimal"
          - "vim-data"
          - "nano"
          - "makemkv"
          - "lutris"
          - "tmux"
          - "htop"
      install:
        install-weak-deps: false
        packages:
          - "virt-install"
          - "libvirt-daemon-config-network"
          - "libvirt-daemon-kvm"
          - "edk2-ovmf"
          - "libguestfs-tools"
          - "python3-libguestfs"
          - "virt-top"
          - "swtpm"
          - "bridge-utils"
          - "gnome-boxes"
          - "go"
          - "gstreamer1-plugin-libav"
          - "gstreamer1-plugins-bad-free-extras"
          #- "gstreamer1-plugins-bad-freeworld"
          - "gstreamer1-plugins-ugly"
          - "gstreamer1-vaapi"
          - "libaacs"
          - "libbdplus"
          - "libbluray"
          - "libdvdcss"
          - "steam"
          - "steam-devices"
          - "gamemode"
          - "mangohud"
          - "gamescope"
          - "vulkan-tools"
          - "crun"
          - "podman"
          - "podman-compose"
          - "skopeo"
          - "cosign"
          - "waydroid"
          - "android-tools"
          - "fuse3"
          - "dash"
          - "helix"
          - "corectrl"
          - "pciutils"
          - "openrgb"
          - "fedora-flathub-remote"
          - "nu"
          - "zoxide"
          - "ydotool"
          - "zellij"
          - "btop"
          - "scx-scheds"
          - "clamav"
          - "clamd"
          - "clamav-update"
          - "python3-pip"
          - "libadwaita"
          - "yafti"
    - type: dnf
      remove:
        auto-remove: true
        packages:
           - "fuse"
           - "gnome-shell-extension-hotedge"
           - "gnome-shell-extension-logo-menu"
           - "gnome-shell-extension-just-perfection"
           - "gnome-shell-extension-compiz-alike-magic-lamp-effect"
           - "gnome-shell-extension-compiz-windows-effect"
           - "gnome-shell-extension-desktop-cube"
           - "gnome-shell-extension-window-list"
           - "gnome-shell-extension-restart-to"
           - "gnome-shell-extension-burn-my-windows"
           - "gnome-shell-extension-places-menu"
           - "gnome-shell-extension-launch-new-instance"
           - "gnome-shell-extension-coverflow-alt-tab"
           - "gnome-shell-extension-apps-menu"
           - "gnome-shell-extension-user-theme"
           - "gnome-shell-extension-tailscale-gnome-qs"
           - "gnome-shell-extension-search-light"
           - "gnome-shell-extension-gsconnect"
           - "gnome-shell-extension-dash-to-dock"
           - "gnome-shell-extension-blur-my-shell"
           - "gnome-shell-extension-appindicator"
           - "cmake"
           #- "gcc-c++"
           - "libglvnd-devel"
           - "cmake-data"
           - "spice-protocol"
           - "nettle-devel"
           - "binutils-devel"
           - "libXi-devel"
           - "libXinerama-devel"
           - "libXcursor-devel"
           - "libXpresent-devel"
           - "libxkbcommon-x11-devel"
           - "wayland-devel"
           - "wayland-protocols-devel"
           - "libXScrnSaver-devel"
           - "libXrandr-devel"
           - "libdecor-devel"
           - "pipewire-devel"
           - "pulseaudio-libs-devel"
           - "libsamplerate-devel"
           - "winetricks"
           - "rom-properties"
           - "rom-properties-utils"
           - "rom-properties-gtk3"
           - "rom-properties-common"
           - "rom-properties-thumbnailer-dbus"
           - "discover-overlay"
           - "gnome-tweaks"
           - "firefox"
           - "firefox-langpacks"
           - "steamdeck-backgrounds"
           - "mediawriter"
           - "webapp-manager"
           - "virt-manager"
           #- "virt-viewer"
           - "vim-enhanced"
           - "vim-minimal"
           - "vim-data"
           - "nano"
           - "makemkv"
           - "lutris"
           - "tmux"
           - "htop"
    - type: script
      snippets:
        - "dnf config-manager setopt tailscale-stable.enabled=0"
        - "dnf config-manager setopt terra.enabled=0"
        - "dnf config-manager setopt terra-extras.enabled=0"
        - "dnf config-manager setopt terra-mesa.enabled=0"
        #- "dnf copr disable ublue-os/packages"
        #- "dnf copr disable ublue-os/akmods"
        #- "dnf copr disable che/nerd-fonts"
        #- "dnf copr disable bieszczaders/kernel-cachyos-addons"
        #- "dnf copr disable varlad/zellij"
