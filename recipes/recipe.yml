---
name: morgi-gwyrdd
description: This is just my persoanl fork of bazzite.
base-image: ghcr.io/ublue-os/bazzite-gnome
image-version: latest
modules:
  # Copy files to the image.
  - type: files
    files:
      - source: system
        destination: /

  # Just Files.
  - type: justfiles
    validate: true
    include:
      - morgi-gwyrdd-generic-hostname.just
  
  # Virtualisation Stack.
  - type: rpm-ostree
  #  repos:
  #    - "https://copr.fedorainfracloud.org/coprs/hikariknight/looking-glass-kvmfr/repo/fedora-42/hikariknight-looking-glass-kvmfr-fedora-42.repo"
    install:
      - "virt-install"
      - "libvirt-daemon-config-network"
      - "libvirt-daemon-kvm"
      - "edk2-ovmf"
      - "virt-manager"
      - "virt-viewer"
      - "libguestfs-tools"
      - "python3-libguestfs"
      - "virt-top"
      - "swtpm"
      - "bridge-utils"
      - "gnome-boxes"
      - "cmake"
      - "gcc"
      - "gcc-c++"
      - "libglvnd-devel"
      - "fontconfig-devel"
      - "spice-protocol"
      - "make"
      - "nettle-devel"
      - "pkgconf-pkg-config"
      - "binutils-devel"
      - "libXi-devel"
      - "libXinerama-devel"
      - "libXcursor-devel"
      - "libXpresent-devel"
      - "libxkbcommon-x11-devel"
      - "wayland-devel"
      - "wayland-protocols-devel"
      - "libXScrnSaver-devel"
      - "libXrandr-devel"
      - "dejavu-sans-mono-fonts"
      - "libdecor-devel"
      #- "pipewire-devel"
      - "pulseaudio-libs-devel"
      - "libsamplerate-devel"
      - "go"
  #- type: akmods
  #  install:
  #    - "kvmfr"
  
  - type: script
    snippets:
      - "git clone --recursive https://github.com/gnif/LookingGlass.git /opt/io.looking-glass.client"
      - "(cd /opt/io.looking-glass.client/;git checkout $(git describe --tags '$(git rev-list --tags --max-count=1)'))"
      - "mkdir -p /opt/io.looking-glass.client/client/build"
      - "(cd /opt/io.looking-glass.client/client/build;cmake -DENABLE_PIPEWIRE=no -DENABLE_LIBDECOR=ON -DCMAKE_INSTALL_PREFIX=/usr ../)"
      - "(cd /opt/io.looking-glass.client/client/build;make)"
      - "mkdir -p /usr/share/doc/looking-glass-client/"
      - "install -Dm 644 /opt/io.looking-glass.client/client/build/looking-glass-client /usr/bin/looking-glass-client"
      - "install -Dm 644 /opt/io.looking-glass.client/README.md /usr/share/doc/looking-glass-client/README.md"
      - "install -Dm 644 /opt/io.looking-glass.client/LICENSE /usr/share/doc/looking-glass-client/LICENSE"
      - "install -Dm 644 /opt/io.looking-glass.client/AUTHORS /usr/share/doc/looking-glass-client/AUTHORS"
      - "install -Dm 644 /opt/io.looking-glass.client/CONTRIBUTORS /usr/share/doc/looking-glass-client/CONTRIBUTORS"
      - "install -Dm 644 /opt/io.looking-glass.client/resources/lg-logo.svg /usr/share/icons/hicolor/scalable/apps/io.looking-glass.client.svg"
      #- "(cd /opt/io.looking-glass.clinet/client/build;make install)"
  
  # Vibrant Updater.
  - type: script
    snippets:
      - "git clone https://codeberg.org/vibrantleaf/vibrant-updater.git /opt/org.codeberg.vibrantleaf.vibrant-updater"
      - "(cd /opt/org.codeberg.vibrantleaf.vibrant-updater;git checkout $(git describe --tags '$(git rev-list --tags --max-count=1)'))"
      #- "curl -Lo /usr/bin/vibrant-updater https://codeberg.org/vibrantleaf/vibrant-updater/releases/download/1.0.12-2025-01-26/vibrant-updater.linux.x86_64.1.0.12-2025-01-26"
      - "go build -o /usr/bin/vibrant-updater /opt/org.codeberg.vibrantleaf.vibrant-updater/src/vibrant_updater.go"
      - "mkdir -p /usr/share/vibrant-updater/"
      - "install -Dm 644 /opt/org.codeberg.vibrantleaf.vibrant-updater/LICENSE.txt /usr/share/vibrant-updater/LICENSE.en.txt"
      - "install -Dm 644 /opt/org.codeberg.vibrantleaf.vibrant-updater/src/VibrantUpdater.just /usr/share/vibrant-updater/VibrantUpdater.just"
      - "install -Dm 644 /opt/org.codeberg.vibrantleaf.vibrant-updater/src/VibrantUpdater-user.timer /usr/share/vibrant-updater/VibrantUpdater-user.timer"
      #- "install -Dm 644 /opt/org.codeberg.vibrantleaf.vibrant-updater/src/VibrantUpdater.desktop /usr/share/applications/VibrantUpdater.desktop"
      - "install -Dm 644 /opt/org.codeberg.vibrantleaf.vibrant-updater/assets/Logo_Circle.svg /usr/share/icons/hicolor/scalable/apps/org.codeberg.vibrantleaf.vibrant-updater.svg"      
  
  # Bluebuild CLI.
  - type: copy
    from: ghcr.io/blue-build/cli:latest
    src: /usr/bin/bluebuild
    dest: /usr/bin/bluebuild

  # Codecs.
  - type: rpm-ostree
    install:
      - "rpmfusion-free-release-tainted"
      - "rpmfusion-nonfree-release-tainted"
  - type: rpm-ostree
    install:
      - "gstreamer1-plugin-libav"
      - "gstreamer1-plugins-bad-free-extras"
      - "gstreamer1-plugins-bad-freeworld"
      - "gstreamer1-plugins-ugly"
      - "gstreamer1-vaapi"
      - "libaacs"
      - "libbdplus"
      - "libbluray"
      - "libdvdcss"

  # Default Flatpaks.
  - type: default-flatpaks
    notify: true
    user: {}
    system:
      install:
        - org.mozilla.firefox
        - org.libreoffice.LibreOffice
        - org.localsend.localsend_app
        - dev.geopjr.Collision
        - org.gnome.World.Secrets
        - com.belmoussaoui.Authenticator
        - com.github.tchx84.Flatseal
        - io.gitlab.adhami3310.Impression
        - ca.edestcroix.Recordbox
        - page.tesk.Refine
        - com.github.marhkb.Pods
        - io.github.dvlv.boxbuddyrs

  # Set GNOME tweaks.
  - type: gnome-extensions
    install:
      - 4655 # Date Menu Formatter
      - 6784 # Wiggle
      - 3733 # Tiling Assistant
      - 7867 # App Grid Wizard
      - 4691 # PiP on top
      - 5940 # Quick Settings Audio Panel
  - type: gschema-overrides
    include:
      - gnome_settings.gschema.override
      
  # Get Bluefin Wallpapers.
  - type: copy
    from: ghcr.io/ublue-os/bluefin:stable
    src: /usr/share/backgrounds/bluefin
    dest: /usr/share/backgrounds/bluefin

  # Get Aruroa Wallpapers.
  - type: copy
    from: ghcr.io/ublue-os/aurora:stable
    src: /usr/share/backgrounds/aurora
    dest: /usr/share/backgrounds/aurora

# Cleanning.
  - type: rpm-ostree
    remove:
      - "cmake"
      - "gcc-c++"
      - "libglvnd-devel"
      - "cmake-data"
      - "spice-protocol"
      - "nettle-devel"
      - "binutils-devel"
      - "libXi-devel"
      - "libXinerama-devel"
      - "libXcursor-devel"
      - "libXpresent-devel"
      - "libxkbcommon-x11-devel"
      - "wayland-devel"
      - "wayland-protocols-devel"
      - "libXScrnSaver-devel"
      - "libXrandr-devel"
      - "libdecor-devel"
      #- "pipewire-devel"
      - "pulseaudio-libs-devel"
      - "libsamplerate-devel"
      - "go"
      - "lutris"
      - "gnome-shell-extension-hotedge"
      - "gnome-shell-extension-bazzite-menu"
      - "gnome-shell-extension-just-perfection"
      - "gnome-shell-extension-compiz-alike-magic-lamp-effect"
      - "gnome-shell-extension-compiz-windows-effect"
      - "rom-properties-gtk3"
      #- "gnome-tweaks"
      #- "firefox"
      #- "firefox-langpacks"
      #- "steamdeck-backgrounds"
      #- mediawriter
  - type: script
    snippets:
      - "chmod 644 /usr/share/applications/looking-glass.desktop"
      - "chmod 644 /usr/share/applications/vibrant-updater.desktop"
      - "chmod +x /usr/bin/bluebuild"
      - "chmod +x /usr/bin/looking-glass-client"
      - "chmod +x /usr/bin/vibrant-updater"
      - "rm -rfv /opt/org.codeberg.vibrantleaf.vibrant-updater"
      - "rm -rfv /opt/io.looking-glass.client"
  
  # great gnome app recommendations.
  - type: yafti
    custom-flatpaks:
      - GNOME Web (Web Browser): org.gnome.Epiphany
      - GNOME Podcasts (Podcast Player): org.gnome.Podcasts
      - GNOME Showtime (Video Player): org.gnome.Showtime
      - GNOME Audio Player (Audio Player): org.gnome.Decibels
      - GNOME Image Viewer (Image Viewer): org.gnome.Loupe
      - GNOME Sound Recorder: org.gnome.SoundRecorder
      - GNOME Maps (Maps App): org.gnome.Maps
      - GNOME Weather (Weather App): org.gnome.Weather
      - GNOME Polari (IRC Client): org.gnome.Polari
      - GNOME Video Trimer: org.gnome.gitlab.YaLTeR.VideoTrimmer
      - GNOME Geary (Email Client): org.gnome.Geary
      - GNOME Papers (PDF Reader): org.gnome.Papers
      - GNOME Citations (Bibliographie Manager): org.gnome.World.Citations
      - GNOME Simple Scan (Document Scanner): org.gnome.SimpleScan
      - GNOME Pika Backup (Borg Backup): org.gnome.World.PikaBackup
      - GNOME Logs (System Log Viewer): org.gnome.Logs
      - GNOME Builder (Code Editor): org.gnome.Builder
      - GNOME Emblem (Project Logo Creater): org.gnome.design.Emblem
      - Alpaca (Local Offline AI App): com.jeffser.Alpaca
      - Alpaca Ollama Plugin: com.jeffser.Alpaca.Plugins.Ollama
      - Alpaca AMD plugin: com.jeffser.Alpaca.Plugins.AMD
      - Carburetor (TOR Browser): io.frama.tractor.carburetor
      - NewsFlash (RSS Reader): io.gitlab.news_flash.NewsFlash
      - Varia (Download Manager): io.github.giantpinkrobots.varia
      - Read it Later (Wallabag Client): com.belmoussaoui.ReadItLater
      - Wike (Wikipedia Reader): com.github.hugolabe.Wike
      - Fractal (Torrent Client): org.gnome.Fractal
      - Dimo (XMPP Client): im.dino.Dino
      - Tuba (Mastodon Client): dev.geopjr.Tuba
      - Lemonade (Lemmy Client): ml.mdwalters.Lemonade
      - Fotema (Photo Gallary App): app.fotema.Fotema
      - Pinta (Paint App): com.github.PintaProject.Pinta
      - Shortwave (Internet Radio Player): de.haeckerfelix.ShortwavedRecorder
      - Exhibit (3D Model Viewer): io.github.nokse22.Exhibit
      - Chronograph (Music Lyrics Manager): io.github.dzheremi2.lrcmake-gtk
      - EarTag (Audio File Tags Editor): app.drey.EarTag
      - Conjure (Image Magic Client): io.github.nate_xyz.Conjure
      - Switcheroo (Image Converter): io.gitlab.adhami3310.Converter
      - Footage (Video Clip Editor): io.gitlab.adhami3310.Footage
      - Aviator (AV1,Opus,Webm Transcoder): net.natesales.Aviator
      - Delfin (Jellyfin Client): cafe.avery.Delfin
      - Plnify (Planer/Todo App): io.github.alainm23.planify
      - Rnote (Note Taking App): com.github.flxzt.rnote
      - Paper Clip (PDF Metedata Editor): io.github.diegoivan.pdf_metadata_editor
      - Fruit Credits (Accounting App): com.dz4k.FruitCredits
      - File Shreder: com.github.ADBeveridge.Raider
      - Obfuscate (Image Censoring Tool): com.belmoussaoui.Obfuscate
      - Metadata Cleaner (Image Metadata cleaner): fr.romainvigier.MetadataCleaner
      - Lock (GnuPG Frontend): com.konstantintutsch.Lock
      - Vaults (Encrypted Vault Tool): io.github.mpobaschnig.Vaults
      - IP Lookup: io.github.bytezz.IPLookup
      - GDM Settings (Login Screen Settings): io.github.realmazharhussain.GdmSettings
      - Main Menu (Menu Editor): page.codeberg.libre_menu_editor.LibreMenuEditor
      - Dconf Editor: ca.desrt.dconf-editor
      - pwvucontrol (Pipewire Audio Control): com.saivert.pwvucontrol
      - Helvum (Pipewire Patch Bay): org.pipewire.Helvum
      - Easy Effects (Pipewire Audio Effects): com.github.wwmm.easyeffects
      - Celeste (Cloud Storage App): com.hunterwittenborn.Celeste
      - Junction (URL Director): re.sonny.Junction
      - D-Spy (Dbus Connection Viewer): org.gnome.dspy
      - Echo (Ping App): io.github.lo2dev.Echo
      - Concessio (UNIX File Permison Calcuator): io.github.ronniedroid.concessio
      - Door Knocker (xdg-desktop-portal checker): xyz.tytanium.DoorKnocker
      - Flatsweep (Flatpak Cleaner): io.github.giantpinkrobots.flatsweep
      - Add Water (Firefox Themer): dev.qwery.AddWater
      - AdwSteamGtk (Steam Themer): io.github.Foldex.AdwSteamGtk
      - Schems (Colour Scheme Creater): app.devsuite.Schemes
      - Dynamic Wallpaper: me.dusansimic.DynamicWallpaper
      - Embelish (Nerd Fonts Downloader): io.github.getnf.embellish
      - Picure of the Day: de.swsnr.pictureoftheday
      - SaveDesktop (Save Desktop Config): io.github.vikdevelop.SaveDesktop
      - Seabird (Kubernetes IDE): dev.skynomads.Seabird
      - Turtle (Git Client): de.philippun1.turtle
      - Forge Sparks (Git Forge Notifcations): com.mardojai.ForgeSparks
      - Webfont Kit Generator: com.rafaelmardojai.WebfontKitGenerator
      - Design (2D CAD Software): io.github.dubstar_04.design
      - Coulomb (PCB CAD Software): io.github.hamza_algohary.Coulomb
      - Upscaler (Image AI Upscaler): io.gitlab.theevilskeleton.Upscaler
      - Reactions (GIF Search): dev.atoft.Reactions
      - Nostalgia (Old GNOME Wallpapers): im.bernard.Nostalgia
      - Blanket (Background Audio Engine): com.rafaelmardojai.Blanket
      - Mingle (Emoji Combiner): io.github.halfmexican.Mingle
      - Cavalier (Audio Visuliser): org.nickvision.cavalier
      - Boxy SVG (Vector Drawing App): com.boxy_svg.BoxySVG
      - Dot Matrix (Dot Matrix Drawing App): io.github.lainsce.DotMatrix
      - ASCII Draw (ASCII Art Tool): io.github.nokse22.asciidraw
      - Cozy (Audio Book Reader): com.github.geigi.cozy
      - Foliate (eBook Reader): com.github.johnfactotum.Foliate
  
  # Signing.
  - type: signing
